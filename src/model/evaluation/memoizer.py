import inspect
import torch
from pathlib import Path

# A utility function to help me memoize things quickly
def memoize(cache_path: Path, source: Path):
    def memoize_impl(func: callable):
        def wrapper(*args, **kwargs):
            if cache_path.exists():
                result = torch.load(cache_path)
                print(f"Reusing existing cache from {cache_path}")
                print(f"Cache is generated by {result['source']}")
                return result["result"]
            else:
                result = func(*args, **kwargs)
                torch.save({"source": source, "result": result}, cache_path)
                return result
        return wrapper
    return memoize_impl

def load_cache(cache_path: Path):
    result = torch.load(cache_path)
    print(f"Loading cache from {result['source']}")
    return result["result"]
